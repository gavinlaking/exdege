#!/usr/bin/env ruby

require 'listen'

target = ARGV.clone.first
files = Set.new

listener = Listen.to(target) do |_modified, added, _removed|
  (added - files.to_a).each do |file|
    if File.extname(file) == '.png'
     system("xdg-open #{file}")
     files.add(file)
    end
  end
end

thread = Thread.new { listener.start }

trap('INT') do
  listener.stop
  thread.join
  exit
end

sleep

